<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>第 22 章 案例研究 | 现代应用统计与 R 语言</title>
<meta name="author" content="黄湘云">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs/header-attrs.js"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/plotly-binding/plotly.js"></script><script src="libs/typedarray/typedarray.min.js"></script><link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main/plotly-latest.min.js"></script><script src="libs/proj4js/proj4.js"></script><link href="libs/highcharts/css/motion.css" rel="stylesheet">
<script src="libs/highcharts/highcharts.js"></script><script src="libs/highcharts/highcharts-3d.js"></script><script src="libs/highcharts/highcharts-more.js"></script><script src="libs/highcharts/modules/stock.js"></script><script src="libs/highcharts/modules/map.js"></script><script src="libs/highcharts/modules/annotations.js"></script><script src="libs/highcharts/modules/data.js"></script><script src="libs/highcharts/modules/drilldown.js"></script><script src="libs/highcharts/modules/item-series.js"></script><script src="libs/highcharts/modules/offline-exporting.js"></script><script src="libs/highcharts/modules/overlapping-datalabels.js"></script><script src="libs/highcharts/modules/exporting.js"></script><script src="libs/highcharts/modules/export-data.js"></script><script src="libs/highcharts/modules/funnel.js"></script><script src="libs/highcharts/modules/heatmap.js"></script><script src="libs/highcharts/modules/treemap.js"></script><script src="libs/highcharts/modules/sankey.js"></script><script src="libs/highcharts/modules/dependency-wheel.js"></script><script src="libs/highcharts/modules/organization.js"></script><script src="libs/highcharts/modules/solid-gauge.js"></script><script src="libs/highcharts/modules/streamgraph.js"></script><script src="libs/highcharts/modules/sunburst.js"></script><script src="libs/highcharts/modules/vector.js"></script><script src="libs/highcharts/modules/wordcloud.js"></script><script src="libs/highcharts/modules/xrange.js"></script><script src="libs/highcharts/modules/tilemap.js"></script><script src="libs/highcharts/modules/venn.js"></script><script src="libs/highcharts/modules/gantt.js"></script><script src="libs/highcharts/modules/timeline.js"></script><script src="libs/highcharts/modules/parallel-coordinates.js"></script><script src="libs/highcharts/modules/bullet.js"></script><script src="libs/highcharts/modules/coloraxis.js"></script><script src="libs/highcharts/modules/dumbbell.js"></script><script src="libs/highcharts/modules/lollipop.js"></script><script src="libs/highcharts/modules/series-label.js"></script><script src="libs/highcharts/plugins/motion.js"></script><script src="libs/highcharts/custom/reset.js"></script><script src="libs/highcharts/modules/boost.js"></script><script src="libs/highchart-binding/highchart.js"></script><script src="libs/es6shim/es6shim.js"></script><script src="libs/es7shim/es7shim.js"></script><script src="libs/graphre/graphre.js"></script><script src="libs/nomnoml/nomnoml.js"></script><script src="libs/nomnoml-binding/nomnoml.js"></script><script src="libs/plotly-locale-zh-CN/zh-cn.js"></script><script src="libs/mathjax/cdn.js"></script><link href="libs/dygraphs/dygraph.css" rel="stylesheet">
<script src="libs/dygraphs/dygraph-combined.js"></script><script src="libs/dygraphs/shapes.js"></script><script src="libs/moment/moment.js"></script><script src="libs/moment-timezone/moment-timezone-with-data.js"></script><script src="libs/moment-fquarter/moment-fquarter.min.js"></script><script src="libs/dygraphs-binding/dygraphs.js"></script><script src="libs/Dygraph.Plugins.Unzoom/unzoom.js"></script><script src="libs/echarts4r/echarts-en.min.js"></script><script src="libs/echarts4r/ecStat.min.js"></script><script src="libs/echarts4r/dataTool.min.js"></script><script src="libs/echarts4r-binding/echarts4r.js"></script><script src="libs/echarts-world/world.js"></script><script src="libs/d3/d3.min.js"></script><script src="libs/forceNetwork-binding/forceNetwork.js"></script><link href="libs/vis/vis.css" rel="stylesheet">
<script src="libs/vis/vis.min.js"></script><script src="libs/visNetwork-binding/visNetwork.js"></script><script src="libs/FileSaver/FileSaver.min.js"></script><script src="libs/Blob/Blob.js"></script><script src="libs/canvas-toBlob/canvas-toBlob.js"></script><script src="libs/html2canvas/html2canvas.js"></script><script src="libs/jspdf/jspdf.debug.js"></script><link href="libs/jquery-sparkline/jquery.sparkline.css" rel="stylesheet">
<script src="libs/jquery-sparkline/jquery.sparkline.js"></script><script src="libs/sparkline-binding/sparkline.js"></script><script src="libs/r2d3-render/r2d3-render.js"></script><script src="libs/webcomponents/webcomponents.js"></script><script src="libs/r2d3-binding/r2d3.js"></script><script src="libs/d3v6/d3.min.js"></script><link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding/datatables.js"></script><link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core/js/jquery.dataTables.min.js"></script><script src="libs/jszip/jszip.min.js"></script><script src="libs/pdfmake/pdfmake.js"></script><script src="libs/pdfmake/vfs_fonts.js"></script><link href="libs/dt-ext-buttons/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="libs/dt-ext-buttons/js/dataTables.buttons.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.flash.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.html5.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.colVis.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.print.min.js"></script><link href="libs/dt-ext-rowgroup/css/rowGroup.dataTables.min.css" rel="stylesheet">
<script src="libs/dt-ext-rowgroup/js/dataTables.rowGroup.min.js"></script><script src="libs/kePrint/kePrint.js"></script><link href="libs/lightable/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-54GQKWF7VP"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-54GQKWF7VP');
    </script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">现代应用统计与 R 语言</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">欢迎</a></li>
<li><a class="" href="chap-preface.html"><span class="header-section-number">1</span> 前言</a></li>
<li><a class="" href="chap-notations.html"><span class="header-section-number">2</span> 符号说明</a></li>
<li><a class="" href="chap-file-operations.html"><span class="header-section-number">3</span> 文件操作</a></li>
<li><a class="" href="chap-data-structure.html"><span class="header-section-number">4</span> 数据结构</a></li>
<li><a class="" href="chap-data-manipulation.html"><span class="header-section-number">5</span> 数据操作</a></li>
<li><a class="" href="chap-data-transportation.html"><span class="header-section-number">6</span> 数据搬运</a></li>
<li><a class="" href="chap-data-visualization.html"><span class="header-section-number">7</span> 数据可视化</a></li>
<li><a class="" href="chap-dynamic-documents.html"><span class="header-section-number">8</span> 动态文档</a></li>
<li><a class="" href="chap-interactive-web-graphics.html"><span class="header-section-number">9</span> 交互图形</a></li>
<li><a class="" href="chap-interactive-data-tables.html"><span class="header-section-number">10</span> 交互表格</a></li>
<li><a class="" href="chap-interactive-shiny-app.html"><span class="header-section-number">11</span> 交互报表</a></li>
<li><a class="" href="chap-string-operations.html"><span class="header-section-number">12</span> 字符串操作</a></li>
<li><a class="" href="chap-regular-expressions.html"><span class="header-section-number">13</span> 正则表达式</a></li>
<li><a class="" href="chap-text-analysis.html"><span class="header-section-number">14</span> 文本分析</a></li>
<li><a class="" href="chap-sampling-distributions.html"><span class="header-section-number">15</span> 抽样分布</a></li>
<li><a class="" href="chap-parameter-estimators.html"><span class="header-section-number">16</span> 参数估计</a></li>
<li><a class="" href="chap-hypothesis-test.html"><span class="header-section-number">17</span> 假设检验</a></li>
<li><a class="" href="chap-power-Analysis.html"><span class="header-section-number">18</span> 功效分析</a></li>
<li><a class="" href="chap-experimental-design.html"><span class="header-section-number">19</span> 试验设计</a></li>
<li><a class="" href="chap-linear-models.html"><span class="header-section-number">20</span> 线性模型</a></li>
<li><a class="" href="chap-generalized-linear-models.html"><span class="header-section-number">21</span> 广义线性模型</a></li>
<li><a class="active" href="chap-case-study.html"><span class="header-section-number">22</span> 案例研究</a></li>
<li><a class="" href="chap-data-explorer.html"><span class="header-section-number">23</span> 数据探索</a></li>
<li><a class="" href="chap-survival-analysis.html"><span class="header-section-number">24</span> 生存分析</a></li>
<li><a class="" href="chap-time-series-analysis.html"><span class="header-section-number">25</span> 时序分析</a></li>
<li><a class="" href="chap-spatial-analysis.html"><span class="header-section-number">26</span> 空间分析</a></li>
<li><a class="" href="chap-spatial-modeling.html"><span class="header-section-number">27</span> 空间建模</a></li>
<li><a class="" href="chap-bayesian-models.html"><span class="header-section-number">28</span> 贝叶斯模型</a></li>
<li><a class="" href="chap-gradient-boosting-machine.html"><span class="header-section-number">29</span> 梯度提升机</a></li>
<li><a class="" href="chap-neural-network.html"><span class="header-section-number">30</span> 神经网络</a></li>
<li><a class="" href="chap-matrix-operations.html"><span class="header-section-number">31</span> 矩阵运算</a></li>
<li><a class="" href="chap-symbolic-computation.html"><span class="header-section-number">32</span> 符号计算</a></li>
<li><a class="" href="chap-numerical-optimization.html"><span class="header-section-number">33</span> 数值优化</a></li>
<li class="book-part">附录</li>
<li><a class="" href="chap-linux-command-bash.html"><span class="header-section-number">A</span> 命令行操作</a></li>
<li><a class="" href="chap-other-softwares.html"><span class="header-section-number">B</span> 其它软件</a></li>
<li><a class="" href="chap-mixed-programming.html"><span class="header-section-number">C</span> 混合编程</a></li>
<li><a class="" href="chap-object-oriented-programming.html"><span class="header-section-number">D</span> 面向对象编程</a></li>
<li><a class="" href="references.html">参考文献</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/XiangyunHuang/masr">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chap-case-study" class="section level1" number="22">
<h1>
<span class="header-section-number">第 22 章</span> 案例研究<a class="anchor" aria-label="anchor" href="#chap-case-study"><i class="fas fa-link"></i></a>
</h1>
<p>提升回归模型的10个提示
<a href="https://statmodeling.stat.columbia.edu/wp-content/uploads/2020/07/raos_tips.pdf">10 quick tips to improve your regression modeling</a></p>
<p><a href="https://github.com/tidymodels/tidymodels">tidymodels</a> 和 <a href="https://github.com/easystats/easystats">easystats</a> 都是基于 <a href="https://github.com/tidyverse/tidyverse">tidyverse</a> <span class="citation">(<a href="references.html#ref-Hadley_2019_tidyverse" role="doc-biblioref">Wickham et al. 2019</a>)</span> 的统计模型套件，<a href="https://github.com/strengejacke/strengejacke">strengejacke</a>、 <a href="https://github.com/mlr-org/mlr3verse">mlr3verse</a> 目的和 tidymodels 差不多，都是提供做数据建模的完整解决方案，区别在于它不基于 tidyverse 这套东西。</p>
<p><a href="https://github.com/easystats/easystats">easystats</a> 包含 <a href="https://github.com/easystats/insight">insight</a> <span class="citation">(<a href="references.html#ref-ludecke2019insight" role="doc-biblioref">Lüdecke, Waggoner, and Makowski 2019</a>)</span> 和 <a href="https://github.com/easystats/bayestestR">bayestestR</a> <span class="citation">(<a href="references.html#ref-makowski2019bayestestr" role="doc-biblioref">Makowski, Ben-Shachar, and Lüdecke 2019</a>)</span> 等共 9 个R 包，<a href="https://github.com/tidymodels/tidymodels">tidymodels</a> 也包含差不多量的 R 包。</p>
<p><a href="https://github.com/harrelfe/rms">rms</a> Regression Modeling Strategies</p>
<p><a href="https://github.com/vincentarelbundock/modelsummary">modelsummary</a> 整理模型输出，提供丰富的格式输出，如 PDF, Text/Markdown, LaTeX, MS Word, RTF, JPG, and PNG.</p>
<p><a href="https://github.com/ModelOriented/DrWhy">DrWhy</a></p>
<p><a href="https://github.com/rfordatascience">R for Data Science Online Learning Community</a> 在线学习社区以 <a href="https://github.com/rfordatascience/tidytuesday">tidytuesday</a> 闻名遐迩。</p>
<div class="figure" style="text-align: center">
<span id="fig:workflow"></span>
<div id="htmlwidget-0a40f93a57a668df2548" style="width:672px;height:480px;" class="nomnoml html-widget"></div>
<script type="application/json" data-for="htmlwidget-0a40f93a57a668df2548">{"x":{"code":"\n#fill: #FEFEFF\n#lineWidth: 1\n#zoom: 4\n#direction: right\n\n\n#padding: 25\n#fontsize: 18\n#fill: #FFDAE1; #FFA9D4\n#stroke: #C71585\n#linewidth: 2\n\n[Import] -> [Understand]\n\n[Understand |\n  [Wrangle] -> [Visualize]\n  [Visualize] -> [Model]\n  [Model] -> [Wrangle]\n]\n\n[Understand] -> [Communicate]\n","svg":false},"evals":[],"jsHooks":[]}</script><p class="caption">
图 22.1: 模型
</p>
</div>
<p>统计建模：两种文化 <span class="citation">(<a href="references.html#ref-Breiman_2001_Modeling" role="doc-biblioref">Breiman 2001</a>)</span></p>
<blockquote>
<p>这些案例来自 Kaggle、 Tudesday 或者自己找的数据集，而不是论文里，或者 R 包里的小数据集，应该更加真实，贴近实际问题，考虑更多细节</p>
</blockquote>
<div id="sec-life-of-statisticians" class="section level2" number="22.1">
<h2>
<span class="header-section-number">22.1</span> 统计学家生平<a class="anchor" aria-label="anchor" href="#sec-life-of-statisticians"><i class="fas fa-link"></i></a>
</h2>
<!-- 定位：不用任何数据建模的手段，我只是呈现数据本身，但是给人的感觉要达到，一眼就能获得一个直接的感觉，读者立马就能有个感觉，这个感觉就是知道影响统计学家寿命的重大因素有哪些，后续的检验只是帮助我们更加准确地知道影响的大小 -->
<p>世纪统计学家 100 位统计学家，寿命的影响因素，关联分析，图展示数据本身的</p>
<!-- https://github.com/XiangyunHuang/MSG-Book/issues/74 -->
<p>注明每位统计学家所在的年代经历的重大事件，如欧洲中世纪霍乱，第二次世界大战，文化大革命，用图形来讲故事，展现数据可视化的魅力，参考文献 <span class="citation">(<a href="references.html#ref-Statisticians_1997_Johnson" role="doc-biblioref">Johnson and Kotz 1997</a>)</span></p>
</div>
<div id="sec-history-of-r" class="section level2" number="22.2">
<h2>
<span class="header-section-number">22.2</span> R 语言发展历史<a class="anchor" aria-label="anchor" href="#sec-history-of-r"><i class="fas fa-link"></i></a>
</h2>
<p>R 语言发展历史和现状，用图来表达</p>
</div>
<div id="sec-PlantGrowth" class="section level2" number="22.3">
<h2>
<span class="header-section-number">22.3</span> 不同实验条件下植物生长情况<a class="anchor" aria-label="anchor" href="#sec-PlantGrowth"><i class="fas fa-link"></i></a>
</h2>
<p>PlantGrowth 数据集收集自 Annette J. Dobson 所著书籍《An Introduction to Statistical Modelling》<span class="citation">(<a href="references.html#ref-Dobson_1983_Modelling" role="doc-biblioref">Dobson 1983</a>)</span> 第 2 章第 2 节的案例 — 研究植物在两种不同试验条件下的生长情况，植物通过光合作用吸收土壤的养分和空气中的二氧化碳，完成积累，故以植物的干重来刻画植物的生长情况，首先将几乎相同的种子随机地分配到实验组和对照组，基于完全随机实验设计（completely randomized experimental design），经过预定的时间后，将植物收割，干燥并称重，结果如表 <a href="chap-case-study.html#tab:PlantGrowth-data">22.1</a> 所示</p>
<div class="sourceCode" id="cb896"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># do.call("cbind", lapply(split(PlantGrowth, f = PlantGrowth$group), subset, select = "weight"))</span>
<span class="co">## 或者</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/split.html">split</a></span><span class="op">(</span><span class="va">PlantGrowth</span>, f <span class="op">=</span> <span class="va">PlantGrowth</span><span class="op">$</span><span class="va">group</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># 分组</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">subset</span>, select <span class="op">=</span> <span class="st">"weight"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># 计算</span>
  <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op">(</span><span class="st">"cbind"</span>, <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># 合并</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">PlantGrowth</span><span class="op">$</span><span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># 重命名 `colnames&lt;-`(., levels(PlantGrowth$group))</span>
  <span class="va">t</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">.</span>,
    caption <span class="op">=</span> <span class="st">"不同生长环境下植物的干重"</span>, row.names <span class="op">=</span> <span class="cn">TRUE</span>,
    align <span class="op">=</span> <span class="st">"c"</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:PlantGrowth-data">表 22.1: </span>不同生长环境下植物的干重</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="center">1</th>
<th align="center">2</th>
<th align="center">3</th>
<th align="center">4</th>
<th align="center">5</th>
<th align="center">6</th>
<th align="center">7</th>
<th align="center">8</th>
<th align="center">9</th>
<th align="center">10</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ctrl</td>
<td align="center">4.17</td>
<td align="center">5.58</td>
<td align="center">5.18</td>
<td align="center">6.11</td>
<td align="center">4.50</td>
<td align="center">4.61</td>
<td align="center">5.17</td>
<td align="center">4.53</td>
<td align="center">5.33</td>
<td align="center">5.14</td>
</tr>
<tr class="even">
<td align="left">trt1</td>
<td align="center">4.81</td>
<td align="center">4.17</td>
<td align="center">4.41</td>
<td align="center">3.59</td>
<td align="center">5.87</td>
<td align="center">3.83</td>
<td align="center">6.03</td>
<td align="center">4.89</td>
<td align="center">4.32</td>
<td align="center">4.69</td>
</tr>
<tr class="odd">
<td align="left">trt2</td>
<td align="center">6.31</td>
<td align="center">5.12</td>
<td align="center">5.54</td>
<td align="center">5.50</td>
<td align="center">5.37</td>
<td align="center">5.29</td>
<td align="center">4.92</td>
<td align="center">6.15</td>
<td align="center">5.80</td>
<td align="center">5.26</td>
</tr>
</tbody>
</table></div>
<p>设立对照组（控制组）ctrl 和实验组 trt1 和 trt2，比较不同的处理方式对植物干重的影响</p>
<div class="sourceCode" id="cb897"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">PlantGrowth</span><span class="op">)</span></code></pre></div>
<pre><code>##      weight       group   
##  Min.   :3.590   ctrl:10  
##  1st Qu.:4.550   trt1:10  
##  Median :5.155   trt2:10  
##  Mean   :5.073            
##  3rd Qu.:5.530            
##  Max.   :6.310</code></pre>
<p>每个组都有10颗植物，生长情况如图<a href="chap-case-study.html#fig:plant-growth-fig">22.2</a>所示</p>
<div class="figure" style="text-align: center">
<span id="fig:plant-growth-fig"></span>
<img src="case-study_files/figure-html/plant-growth-fig-1.png" alt="植物干重" width="45%"><img src="case-study_files/figure-html/plant-growth-fig-2.png" alt="植物干重" width="45%"><p class="caption">
图 22.2: 植物干重
</p>
</div>
<p>实验条件 trt1 和 trt2 对植物生长状况有显著的影响，为了量化这种影响，建立线性回归模型</p>
<div class="sourceCode" id="cb899"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_sublm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">group</span>,
  data <span class="op">=</span> <span class="va">PlantGrowth</span>,
  subset <span class="op">=</span> <span class="va">group</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ctrl"</span>, <span class="st">"trt1"</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">fit_sublm</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: weight
##           Df Sum Sq Mean Sq F value Pr(&gt;F)
## group      1 0.6882 0.68820  1.4191  0.249
## Residuals 18 8.7292 0.48496</code></pre>
<div class="sourceCode" id="cb901"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_sublm</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = weight ~ group, data = PlantGrowth, subset = group %in% 
##     c("ctrl", "trt1"))
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.0710 -0.4938  0.0685  0.2462  1.3690 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   5.0320     0.2202  22.850 9.55e-15 ***
## grouptrt1    -0.3710     0.3114  -1.191    0.249    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.6964 on 18 degrees of freedom
## Multiple R-squared:  0.07308,    Adjusted R-squared:  0.02158 
## F-statistic: 1.419 on 1 and 18 DF,  p-value: 0.249</code></pre>
<p>下面再通过检验的方式比较实验组和对照组相比，是否有显著作用</p>
<div class="sourceCode" id="cb903"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 控制组和实验组1比较</span>
<span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">group</span>, data <span class="op">=</span> <span class="va">PlantGrowth</span>, subset <span class="op">=</span> <span class="va">group</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ctrl"</span>, <span class="st">"trt1"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  weight by group
## t = 1.1913, df = 16.524, p-value = 0.2504
## alternative hypothesis: true difference in means between group ctrl and group trt1 is not equal to 0
## 95 percent confidence interval:
##  -0.2875162  1.0295162
## sample estimates:
## mean in group ctrl mean in group trt1 
##              5.032              4.661</code></pre>
<div class="sourceCode" id="cb905"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 控制组和实验组2比较</span>
<span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">group</span>, data <span class="op">=</span> <span class="va">PlantGrowth</span>, subset <span class="op">=</span> <span class="va">group</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ctrl"</span>, <span class="st">"trt2"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  weight by group
## t = -2.134, df = 16.786, p-value = 0.0479
## alternative hypothesis: true difference in means between group ctrl and group trt2 is not equal to 0
## 95 percent confidence interval:
##  -0.98287213 -0.00512787
## sample estimates:
## mean in group ctrl mean in group trt2 
##              5.032              5.526</code></pre>
<p>检验结果表明，实验条件 trt2 会对植物生长产生显著效果，而实验条件 trt1 不会。在假定同方差的情况下，建立线性回归模型，同时考虑实验条件 trt1 和 trt2</p>
<div class="sourceCode" id="cb907"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 模型拟合</span>
<span class="va">fit_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">group</span>, data <span class="op">=</span> <span class="va">PlantGrowth</span><span class="op">)</span>

<span class="co">## 模型输出</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_lm</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = weight ~ group, data = PlantGrowth)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.0710 -0.4180 -0.0060  0.2627  1.3690 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   5.0320     0.1971  25.527   &lt;2e-16 ***
## grouptrt1    -0.3710     0.2788  -1.331   0.1944    
## grouptrt2     0.4940     0.2788   1.772   0.0877 .  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.6234 on 27 degrees of freedom
## Multiple R-squared:  0.2641, Adjusted R-squared:  0.2096 
## F-statistic: 4.846 on 2 and 27 DF,  p-value: 0.01591</code></pre>
<div class="sourceCode" id="cb909"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## 方差分析</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">fit_lm</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: weight
##           Df  Sum Sq Mean Sq F value  Pr(&gt;F)  
## group      2  3.7663  1.8832  4.8461 0.01591 *
## Residuals 27 10.4921  0.3886                  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<div class="sourceCode" id="cb911"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## 参数估计</span>
<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_lm</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##             Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept)    5.032  0.1971284 25.526514 1.936575e-20
## grouptrt1     -0.371  0.2787816 -1.330791 1.943879e-01
## grouptrt2      0.494  0.2787816  1.771996 8.768168e-02</code></pre>
<p>模型输出整理成表 <a href="chap-case-study.html#tab:lm-plant-growth-output">22.2</a> 所示</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:lm-plant-growth-output">表 22.2: </span>线性回归的输出</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">估计值</th>
<th align="right">标准差</th>
<th align="right">t 统计量</th>
<th align="right">P 值</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math inline">\(\alpha\)</span></td>
<td align="right">5.032</td>
<td align="right">0.1971</td>
<td align="right">25.5265</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(\beta_1\)</span></td>
<td align="right">-0.371</td>
<td align="right">0.2788</td>
<td align="right">-1.3308</td>
<td align="right">0.1944</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(\beta_2\)</span></td>
<td align="right">0.494</td>
<td align="right">0.2788</td>
<td align="right">1.7720</td>
<td align="right">0.0877</td>
</tr>
</tbody>
</table></div>
<p>还可以将模型转化为数学公式</p>
<div class="sourceCode" id="cb913"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 理论模型</span>
<span class="fu">equatiomatic</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/equatiomatic/man/extract_eq.html">extract_eq</a></span><span class="op">(</span><span class="va">fit_lm</span><span class="op">)</span></code></pre></div>
<p><span class="math display">\[
\operatorname{weight} = \alpha + \beta_{1}(\operatorname{group}_{\operatorname{trt1}}) + \beta_{2}(\operatorname{group}_{\operatorname{trt2}}) + \epsilon
\]</span></p>
<div class="sourceCode" id="cb914"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 拟合模型</span>
<span class="fu">equatiomatic</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/equatiomatic/man/extract_eq.html">extract_eq</a></span><span class="op">(</span><span class="va">fit_lm</span>, use_coefs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><span class="math display">\[
\operatorname{\widehat{weight}} = 5.03 - 0.37(\operatorname{group}_{\operatorname{trt1}}) + 0.49(\operatorname{group}_{\operatorname{trt2}})
\]</span></p>
<p>进一步地，我们在线性模型的基础上考虑每个实验组有不同的方差，先做方差齐性检验。</p>
<div class="sourceCode" id="cb915"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/bartlett.test.html">bartlett.test</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">group</span>, data <span class="op">=</span> <span class="va">PlantGrowth</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  Bartlett test of homogeneity of variances
## 
## data:  weight by group
## Bartlett's K-squared = 2.8786, df = 2, p-value = 0.2371</code></pre>
<div class="sourceCode" id="cb917"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/fligner.test.html">fligner.test</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">group</span>, data <span class="op">=</span> <span class="va">PlantGrowth</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  Fligner-Killeen test of homogeneity of variances
## 
## data:  weight by group
## Fligner-Killeen:med chi-squared = 2.3499, df = 2, p-value = 0.3088</code></pre>
<p>检验的结果显示，可以认为三个组的方差没有显著差异，但我们还是考虑每个组有不同的方差，看看放开假设能获得多少提升，后续会发现，从对数似然的角度来看，实际提升量很小，只有 7.72%</p>
<p>上面同时比较多个总体的方差，会发现方差没有显著差异，那么接下来在假定方差齐性的条件下，比较均值的差异是否显著？</p>
<div class="sourceCode" id="cb919"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 参数检验，假定异方差</span>
<span class="fu"><a href="https://rdrr.io/r/stats/oneway.test.html">oneway.test</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">group</span>, data <span class="op">=</span> <span class="va">PlantGrowth</span>, var.equal <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  One-way analysis of means (not assuming equal variances)
## 
## data:  weight and group
## F = 5.181, num df = 2.000, denom df = 17.128, p-value = 0.01739</code></pre>
<div class="sourceCode" id="cb921"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 参数检验，假定方差齐性</span>
<span class="fu"><a href="https://rdrr.io/r/stats/oneway.test.html">oneway.test</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">group</span>, data <span class="op">=</span> <span class="va">PlantGrowth</span>, var.equal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  One-way analysis of means
## 
## data:  weight and group
## F = 4.8461, num df = 2, denom df = 27, p-value = 0.01591</code></pre>
<div class="sourceCode" id="cb923"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 非参数检验</span>
<span class="fu"><a href="https://rdrr.io/r/stats/kruskal.test.html">kruskal.test</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">group</span>, data <span class="op">=</span> <span class="va">PlantGrowth</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  Kruskal-Wallis rank sum test
## 
## data:  weight by group
## Kruskal-Wallis chi-squared = 7.9882, df = 2, p-value = 0.01842</code></pre>
<p>检验结果显示它们的均值是有显著差异的！</p>
<div class="sourceCode" id="cb925"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 固定效应模型</span>
<span class="va">fit_gls</span> <span class="op">&lt;-</span> <span class="fu">nlme</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/gls.html">gls</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="fl">1</span>,
  weights <span class="op">=</span> <span class="fu">nlme</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/varIdent.html">varIdent</a></span><span class="op">(</span>form <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">group</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">PlantGrowth</span>, method <span class="op">=</span> <span class="st">"REML"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_gls</span><span class="op">)</span></code></pre></div>
<pre><code>## Generalized least squares fit by REML
##   Model: weight ~ 1 
##   Data: PlantGrowth 
##        AIC      BIC    logLik
##   70.48628 75.95547 -31.24314
## 
## Variance function:
##  Structure: Different standard deviations per stratum
##  Formula: ~1 | group 
##  Parameter estimates:
##      ctrl      trt1      trt2 
## 1.0000000 1.5825700 0.9230865 
## 
## Coefficients:
##                Value Std.Error  t-value p-value
## (Intercept) 5.199759 0.1162421 44.73214       0
## 
## Standardized residuals:
##         Min          Q1         Med          Q3         Max 
## -1.74647988 -0.91870713 -0.07591108  0.60676033  2.03987301 
## 
## Residual standard error: 0.5896195 
## Degrees of freedom: 30 total; 29 residual</code></pre>
<div class="sourceCode" id="cb927"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 随机效应模型</span>
<span class="va">fit_lme</span> <span class="op">&lt;-</span> <span class="fu">nlme</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/lme.html">lme</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="fl">1</span>, random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">group</span>, data <span class="op">=</span> <span class="va">PlantGrowth</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_lme</span><span class="op">)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: PlantGrowth 
##        AIC      BIC    logLik
##   67.44473 71.54662 -30.72237
## 
## Random effects:
##  Formula: ~1 | group
##         (Intercept)  Residual
## StdDev:   0.3865976 0.6233746
## 
## Fixed effects:  weight ~ 1 
##             Value Std.Error DF  t-value p-value
## (Intercept) 5.073 0.2505443 27 20.24792       0
## 
## Standardized Within-Group Residuals:
##          Min           Q1          Med           Q3          Max 
## -1.854449795 -0.688750457  0.006389611  0.406096866  2.059729645 
## 
## Number of Observations: 30
## Number of Groups: 3</code></pre>
<p><span class="math inline">\(\sigma_i^2 = Var(\epsilon_{ij}), i = 1,2,3\)</span> 表示第 <span class="math inline">\(i\)</span> 组的方差，</p>
<p><span class="math display">\[
y_{ij} = \mu + \epsilon_{ij}, i = 1,2,3
\]</span></p>
<p>其中 <span class="math inline">\(\mu\)</span> 是固定的未知参数，我们和之前假定同方差情形下的模型比较一下，现在异方差情况下模型提升的情况，从对数似然的角度来看</p>
<div class="sourceCode" id="cb929"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">fit_lm</span><span class="op">)</span>
<span class="co">## 'log Lik.' -26.80952 (df=4)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">fit_lm</span>, REML <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">## 'log Lik.' -29.00481 (df=4)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">fit_gls</span><span class="op">)</span>
<span class="co">## 'log Lik.' -31.24314 (df=4)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">fit_lme</span><span class="op">)</span>
<span class="co">## 'log Lik.' -30.72237 (df=3)</span></code></pre></div>
<p>进一步地，我们考虑两水平模型，认为不同的实验组其均值和方差都不一样，检验三样本均值是否相等？</p>
<p><span class="math inline">\(\mu_1 = \mu_2 = \mu_3\)</span> 检验，这里因为每组的样本量都一样，因此考虑 Turkey 的 T 法检验，检验均值是否有显著差别，实际上这里因为实验组数量只有2个，可以两两比对，如前所述。但是这里我们想扩展一下，考虑多组比较的问题。</p>
<!-- 书籍 《概率论与数理统计教程》438 页重复数相等场合下的多重比较 T 法 [@Prob_2011_Mao] -->
<p>和上面用 <code>gls</code> 拟合的模型是一致的。</p>
<p><span class="math display">\[\begin{align}
y_{ij}&amp; = \mu_i + \epsilon_{ij}, \\
\mu_i &amp; = \mu_{\theta} + \xi_i. \quad i  = 1,\ldots,3; \quad j = 1, \ldots, 10.
\end{align}\]</span></p>
<p>其中 <span class="math inline">\(\mu_i\)</span> 是随机的未知变量，服从均值为 <span class="math inline">\(\mu_{\theta}\)</span> 方差为 <span class="math inline">\(Var(\xi_i) = \tau^2\)</span> 的正态分布</p>
<p>我们用 <strong>MASS</strong> 包提供的 <code><a href="https://rdrr.io/pkg/MASS/man/glmmPQL.html">glmmPQL()</a></code> 函数拟合该数据集</p>
<div class="sourceCode" id="cb930"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_lme_pql</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/glmmPQL.html">glmmPQL</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="fl">1</span>,
  random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">group</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>,
  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">PlantGrowth</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_lme_pql</span><span class="op">)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##   Data: PlantGrowth 
##   AIC BIC logLik
##    NA  NA     NA
## 
## Random effects:
##  Formula: ~1 | group
##         (Intercept)  Residual
## StdDev:   0.2944234 0.6233746
## 
## Variance function:
##  Structure: fixed weights
##  Formula: ~invwt 
## Fixed effects:  weight ~ 1 
##             Value Std.Error DF  t-value p-value
## (Intercept) 5.073 0.2080656 27 24.38174       0
## 
## Standardized Within-Group Residuals:
##          Min           Q1          Med           Q3          Max 
## -1.922640850 -0.734727623  0.004564386  0.405111223  1.991538416 
## 
## Number of Observations: 30
## Number of Groups: 3</code></pre>
<p>我们再借助 <strong>brms</strong> 包从贝叶斯的角度来分析数据，并建模</p>
<!-- 就以 brms 包为例谈谈先验、参数设置，默认的先验有可能太宽泛了，导致不是很合理 <https://discourse.mc-stan.org/t/11584> -->
<div class="sourceCode" id="cb932"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 贝叶斯模型</span>
<span class="va">fit_brm</span> <span class="op">&lt;-</span> <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">group</span>, data <span class="op">=</span> <span class="va">PlantGrowth</span><span class="op">)</span>
<span class="co"># 参考 https://www.xiangyunhuang.com.cn/2019/05/normal-hierarchical-model/</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.rcpp.org">Rcpp</a></span><span class="op">)</span>
<span class="va">fit_lme_brm</span> <span class="op">&lt;-</span> <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">group</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">PlantGrowth</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span>, 
  refresh <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">2019</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_lme_brm</span><span class="op">)</span></code></pre></div>
</div>
<div id="sec-orange" class="section level2" number="22.4">
<h2>
<span class="header-section-number">22.4</span> 橘树生长情况<a class="anchor" aria-label="anchor" href="#sec-orange"><i class="fas fa-link"></i></a>
</h2>
<!-- 非线性混合效应模型 {#chap-nonlinear-mixed-models} -->
<p>Orange 数据集包含三个变量，记录了加利福尼亚南部的一个小树林中的五棵橘树的生长情况，在 <strong>datasets</strong> 包里，数据集保存为 <code><a href="https://rdrr.io/r/base/c.html">c("nfnGroupedData", "nfGroupedData", "groupedData", "data.frame")</a></code> 类型的数据，同时具有着四个类的特点。</p>
<ul>
<li>Tree: 有序的指示变量，根据5棵橘树的最大直径划分，测量值很可能是根据林务员常用的“胸围周长”</li>
<li>age: 橘树的树龄，自 1968 年 12 月 31 日起按天计算</li>
<li>circumference: 橘树树干的周长，单位是毫米</li>
</ul>
<p>查看部分数据的情况</p>
<div class="sourceCode" id="cb933"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Orange</span><span class="op">)</span></code></pre></div>
<pre><code>## Grouped Data: circumference ~ age | Tree
##   Tree  age circumference
## 1    1  118            30
## 2    1  484            58
## 3    1  664            87
## 4    1 1004           115
## 5    1 1231           120
## 6    1 1372           142</code></pre>
<p>查看变量的属性</p>
<div class="sourceCode" id="cb935"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">Orange</span><span class="op">)</span></code></pre></div>
<pre><code>## Classes 'nfnGroupedData', 'nfGroupedData', 'groupedData' and 'data.frame':   35 obs. of  3 variables:
##  $ Tree         : Ord.factor w/ 5 levels "3"&lt;"1"&lt;"5"&lt;"2"&lt;..: 2 2 2 2 2 2 2 4 4 4 ...
##  $ age          : num  118 484 664 1004 1231 ...
##  $ circumference: num  30 58 87 115 120 142 145 33 69 111 ...
##  - attr(*, "formula")=Class 'formula'  language circumference ~ age | Tree
##   .. ..- attr(*, ".Environment")=&lt;environment: R_EmptyEnv&gt; 
##  - attr(*, "labels")=List of 2
##   ..$ x: chr "Time since December 31, 1968"
##   ..$ y: chr "Trunk circumference"
##  - attr(*, "units")=List of 2
##   ..$ x: chr "(days)"
##   ..$ y: chr "(mm)"</code></pre>
<p>说明 5 棵树之间的大小关系是 <code>3 &lt; 1 &lt; 5 &lt; 2 &lt; 4</code>，这里的数字 1，2，3，4，5 只是对树的编号，第一次测量时树的大小关系在 R 内用有序因子来表示。</p>
<div class="sourceCode" id="cb937"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">Orange</span><span class="op">$</span><span class="va">Tree</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "3" "1" "5" "2" "4"</code></pre>
<p>表 <a href="chap-case-study.html#tab:orange-data">22.3</a> 记录了 5 颗橘树自 1968 年 12 月 31 日以来的生长情况</p>
<div class="sourceCode" id="cb939"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># aggregate(data = Orange, circumference ~  age, FUN = mean)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/reshape.html">reshape</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">Orange</span>, v.names <span class="op">=</span> <span class="st">"circumference"</span>, idvar <span class="op">=</span> <span class="st">"Tree"</span>,
  timevar <span class="op">=</span> <span class="st">"age"</span>, direction <span class="op">=</span> <span class="st">"wide"</span>, sep <span class="op">=</span> <span class="st">""</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">.</span>,
    caption <span class="op">=</span> <span class="st">"躯干周长（毫米）随时间（天）的变化"</span>,
    row.names <span class="op">=</span> <span class="cn">FALSE</span>, col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"(circumference)"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>,
    align <span class="op">=</span> <span class="st">"c"</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:orange-data">表 22.3: </span>躯干周长（毫米）随时间（天）的变化</caption>
<thead><tr class="header">
<th align="center">Tree</th>
<th align="center">118</th>
<th align="center">484</th>
<th align="center">664</th>
<th align="center">1004</th>
<th align="center">1231</th>
<th align="center">1372</th>
<th align="center">1582</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">30</td>
<td align="center">58</td>
<td align="center">87</td>
<td align="center">115</td>
<td align="center">120</td>
<td align="center">142</td>
<td align="center">145</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">33</td>
<td align="center">69</td>
<td align="center">111</td>
<td align="center">156</td>
<td align="center">172</td>
<td align="center">203</td>
<td align="center">203</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">30</td>
<td align="center">51</td>
<td align="center">75</td>
<td align="center">108</td>
<td align="center">115</td>
<td align="center">139</td>
<td align="center">140</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">32</td>
<td align="center">62</td>
<td align="center">112</td>
<td align="center">167</td>
<td align="center">179</td>
<td align="center">209</td>
<td align="center">214</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">30</td>
<td align="center">49</td>
<td align="center">81</td>
<td align="center">125</td>
<td align="center">142</td>
<td align="center">174</td>
<td align="center">177</td>
</tr>
</tbody>
</table></div>
<p>图 <a href="chap-case-study.html#fig:orange-tree">22.3</a> 以直观的方式展示 5 颗橘树的生长变化，相比于表 <a href="chap-case-study.html#tab:orange-data">22.3</a> 我们能更加明确读取数据中的变化</p>
<div class="sourceCode" id="cb940"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Orange</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">circumference</span>, color <span class="op">=</span> <span class="va">Tree</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"age (day)"</span>, y <span class="op">=</span> <span class="st">"circumference (mm)"</span><span class="op">)</span>
<span class="va">p</span></code></pre></div>
<div class="figure" style="text-align: center">
<span id="fig:orange-tree"></span>
<img src="case-study_files/figure-html/orange-tree-1.png" alt="橘树生长模型" width="672"><p class="caption">
图 22.3: 橘树生长模型
</p>
</div>
<div class="sourceCode" id="cb941"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com">gganimate</a></span><span class="op">)</span>
<span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://gganimate.com/reference/transition_reveal.html">transition_reveal</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="case-study_files/figure-html/unnamed-chunk-7-1.gif" style="display: block; margin: auto;"></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="chap-generalized-linear-models.html"><span class="header-section-number">21</span> 广义线性模型</a></div>
<div class="next"><a href="chap-data-explorer.html"><span class="header-section-number">23</span> 数据探索</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chap-case-study"><span class="header-section-number">22</span> 案例研究</a></li>
<li><a class="nav-link" href="#sec-life-of-statisticians"><span class="header-section-number">22.1</span> 统计学家生平</a></li>
<li><a class="nav-link" href="#sec-history-of-r"><span class="header-section-number">22.2</span> R 语言发展历史</a></li>
<li><a class="nav-link" href="#sec-PlantGrowth"><span class="header-section-number">22.3</span> 不同实验条件下植物生长情况</a></li>
<li><a class="nav-link" href="#sec-orange"><span class="header-section-number">22.4</span> 橘树生长情况</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/XiangyunHuang/masr/blob/master/case-study.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/XiangyunHuang/masr/edit/master/case-study.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>现代应用统计与 R 语言</strong>" was written by 黄湘云. It was last built on 2021-08-07.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
